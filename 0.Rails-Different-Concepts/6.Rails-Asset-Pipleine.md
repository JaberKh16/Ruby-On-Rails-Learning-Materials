# The Asset Pipeline in Ruby on Rails

The Asset Pipeline is a framework in Ruby on Rails that provides a structured way to manage and serve static assets such as JavaScript, CSS, images, fonts, and other files. It was introduced in Rails 3.1 and remained the default until Rails 7, when newer alternatives (Propshaft and import maps) became the default for new applications.

Even though newer Rails apps may not use the classic Asset Pipeline by default, it is still widely used in legacy applications and can be enabled in new projects via the `sprockets-rails` gem.

## Key Goals of the Asset Pipeline

- **Asset organization** – Keep stylesheets, JavaScript, and images in logical locations.
- **Preprocessing** – Support languages like SCSS, Sass, CoffeeScript, and ERB in assets.
- **Concatenation** – Combine multiple files into fewer HTTP requests.
- **Minification/Compression** – Reduce file size for faster loading.
- **Fingerprinting** – Add unique hashes to filenames for long-term caching and instant cache invalidation when content changes.
- **CDN compatibility** – Serve assets with unique URLs suitable for Content Delivery Networks.

## Core Components

The Asset Pipeline is powered by **Sprockets**[](https://github.com/rails/sprockets).

Main directories (in a classic Rails app): # to add the static files
app/assets/
├── config/manifest.js          # Links all assets
├── images/                     # Images, icons, etc.
├── javascripts/                # .js, .coffee, .js.erb
└── stylesheets/                # .css, .scss, .sass, .css.erb
lib/assets/                     # Library-specific assets
vendor/assets/                  # Third-party assets (e.g., jQuery, Bootstrap)




## How It Works

1. **Manifest Files**
   - `app/assets/config/manifest.js` tells Sprockets which files to include:
     ```javascript
    
     //= link_tree ../images
     //= link_directory ../javascripts .js
     //= link_directory ../stylesheets .css
     //= link application.js
     //= link application.css



2. **Directives in Files**
  - Inside JavaScript and CSS files, you can use Sprockets directives:SCSS//= require jquery
    
    //= require jquery_ujs
    //= require turbolinks
    //= require_tree .CSS/*= require bootstrap
    *= require_self
    *= require_tree .
  */


3. **Preprocessing**
Files with extensions like .scss, .sass, .coffee, or .erb are preprocessed before serving.

4. **Compilation**
In development: assets are served individually (no concatenation/minification by default).
In production: rails assets:precompile compiles all assets into public/assets/.
Files are concatenated, minified (via Uglifier/YUI for JS, Sass for CSS).
Fingerprinted: application-abc123def456.js


5. **Serving**
Helpers in views:

    <%= stylesheet_link_tag "application", media: "all" %>
    <%= javascript_include_tag "application" %>
    <%= image_tag "logo.png" %>

In production, these point to fingerprinted files and include integrity attributes if configured.


*Configuration (config/assets.rb & others)*
 - Common settings in config/initializers/assets.rb:

# Version of your assets, change to bust cache
Rails.application.config.assets.version = "1.0"

# Precompile additional assets
Rails.application.config.assets.precompile += %w[ admin.js admin.css ]

# Enable compression
Rails.application.config.assets.css_compressor = :sass
Rails.application.config.assets.js_compressor = :uglifier

# Skip digest in filenames (not recommended for production)
Rails.application.config.assets.digest = true


In config/environments/production.rb:

  config.assets.compile = false   # Use precompiled assets
  config.assets.digest = true
  config.assets.compress = true


1. **Asset Precompilation**
  Run before deploying to production:
    $ rails assets:precompile # generates files in public/assets/ with fingerprints and a manifest.json that maps logical names to actual fingerprinted files.
  To delete the compiled files:
    $ rails assets:clobber  # deletes the compilled files

* Modern Alternatives (Rails 7+) *
  - New Rails 7+ applications use simpler alternatives by default:

    Import Maps (importmap-rails) – No build tools, vanilla JS with ES modules.
    Propshaft – Simple digest-based asset serving without concatenation or transpilation.
    jsbundling-rails / cssbundling-rails – Integration with Node.js tools (esbuild, rollup, webpack, etc.).

    You can still use the classic Sprockets Asset Pipeline by adding:
    bundle add sprockets-rails
    $ rails sprockets:install


    When to Use the Classic Asset Pipeline

    Maintaining legacy Rails apps (pre-Rails 7).
    Projects already heavily invested in Sprockets directives and preprocessing.
    When you prefer not to introduce Node.js/build tools.

  Summary:
  The Asset Pipeline (powered by Sprockets) was a groundbreaking feature that made managing front-end assets in Rails applications efficient and production-ready. While newer Rails versions favor lighter or more modern approaches, understanding the Asset Pipeline remains essential for working with many existing Rails codebases.

  *Official Documentation:*
  https://guides.rubyonrails.org/asset_pipeline.html


  ### Check Stylesheets
  - open the rails console
    $ rails console
    $ helpers.stylesheet_link_tag('application')   # print the link tag in app/views/application.html.erb file
    $ helpers.stylesheet_path('application')       # print the path of the application stylesheet

  - see the specific directory in tree format
    $ tree app/assets/
