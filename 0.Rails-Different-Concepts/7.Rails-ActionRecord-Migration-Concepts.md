# Rails Database Migrations Documentation

Rails migrations provide a structured, version-controlled way to manage changes to a database schema over time. They are a core part of Active Record and allow developers to evolve the database safely and consistently across environments.

Migrations act as an abstraction layer over SQL, enabling database changes using Ruby code while remaining database-agnostic.

---

## What Is a Migration?

A migration is a Ruby class that inherits from `ActiveRecord::Migration` and defines changes to apply to the database schema, such as:

- Creating or dropping tables
- Adding, removing, or renaming columns
- Adding indexes and constraints
- Modifying column types
- Managing foreign keys

Each migration represents a single, incremental change.

---

## Why Use Migrations?

- **Version control for schema** – Track database changes over time
- **Consistency** – Same schema across development, test, and production
- **Reversibility** – Ability to roll back changes
- **Database independence** – Works across PostgreSQL, MySQL, SQLite, etc.
- **Team collaboration** – Schema changes are shared through code

---

## Migration Files and Naming

Migration files are stored in: db/migrate/  # where each file will follow the format => YYYYMMDDHHMMSS_create_users.rb


- Timestamp ensures ordering
- Descriptive name explains the change

- Example migration class:

```ruby
class CreateUsers < ActiveRecord::Migration[7.1]
  def change
    create_table :users do |t|
      t.string :name
      t.string :email
      t.timestamps
    end
  end
end
```

*Generating Migrations*

Common generators:
```bin/bash
    
    $ rails generate migration CreateUsers
    $ rails generate migration AddAgeToUsers age:integer
    $ rails generate migration RemoveAdminFromUsers admin:boolean
    $ rails generate migration AddIndexToUsersEmail
```

*Migration Methods*
- change() method
- The preferred method for most migrations. Rails can automatically infer how to reverse it.

```ruby

    def change
        add_column :users, :age, :integer
    end

```

- up and down
- Used when changes are not automatically reversible.

```ruby

    def up
        execute "ALTER TABLE users ADD COLUMN full_name VARCHAR"
    end

    def down
        execute "ALTER TABLE users DROP COLUMN full_name"
    end

```


## Common Migration Operations

### Creating Tables

```ruby
create_table :posts do |t|
  t.string :title
  t.text :body
  t.references :user, foreign_key: true
  t.timestamps
end
```

### Dropping Tables

```ruby
    drop_table :posts

```

### Adding Columns
```ruby

    add_column :users, :age, :integer
```


### Removing Columns

```ruby

    remove_column :users, :age
```

### Changing Columns
```ruby

    change_column :users, :age, :bigint

```


### Renaming Columns

```ruby

    rename_column :users, :username, :login

```


### Working With Index

#### Adding Index
    ```ruby

        add_index :users, :email
        add_index :users, :email, unique: true
    ```

#### Removing Index
    ```ruby

        remove_index :users, :email

    ```


### Working With Foriegn Key

#### Addding Foriegn Key
    ```ruby

        add_reference :posts, :user, foreign_key: true
        add_foreign_key :posts, :users # or explicitly


    ```

#### Removing Foriegn Key
    ```ruby

        remove_foreign_key :posts, :users

    ```


**Running Migrations**
 - use the following commands

    $ rails db:migrate                              # migrate the file
    $ rails db:rollback                             # rollback single step
    $ rails db:rollback STEP=3                      # rollback multiple steps
    $ rails db:migrate VERSION=20240101123045       # migrate to specific version
    $ rails db:migrate:status                       # check migration stauts: change status of up and down


**Schema Files**
- Rails maintains a schema snapshot:

    db/schema.rb — Ruby format (default)
    db/structure.sql — SQL format (used for advanced database features)

    
    This file represents the current database structure and is regenerated after migrations.
